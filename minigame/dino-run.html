<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Â∞èÊÅêÈæôÊ∏∏Êàè - Chrome Dino Game</title>
        <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        body.night-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .game-container {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 900px;
            width: 90%;
        }

        .night-mode .game-container {
            background: rgba(30, 30, 50, 0.95);
            color: #fff;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .night-mode h1 {
            color: #a8b2ff;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .score {
            color: #667eea;
        }

        .night-mode .score {
            color: #a8b2ff;
        }

        .skin-selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .skin-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #667eea;
        }

        .night-mode .skin-selector label {
            color: #a8b2ff;
        }

        .skin-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .skin-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .skin-option:hover {
            transform: scale(1.1);
        }

        .skin-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.6);
        }

        .skin-option.locked {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .skin-option.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
        }

        #gameCanvas {
            width: 100%;
            height: 400px;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: block;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .night-mode #gameCanvas {
            border-color: #a8b2ff;
            background: #2a2a3e;
        }

        #gameCanvas:hover {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .controls {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            font-weight: bold;
            margin: 0 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .night-mode .instructions {
            color: #aaa;
        }

        .notification {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 100;
            display: none;
            animation: notificationSlide 0.5s ease;
        }

        .notification.show {
            display: block;
        }

        @keyframes notificationSlide {
            0% {
                top: -120px;
                opacity: 0;
            }
            100% {
                top: -80px;
                opacity: 1;
            }
        }

        .pause-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
            border-radius: 10px;
        }

        .pause-screen.show {
            display: flex;
        }

        .pause-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .night-mode .pause-content {
            background: rgba(30, 30, 50, 0.95);
            color: #fff;
        }

        .pause-content h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .night-mode .pause-content h2 {
            color: #a8b2ff;
        }

        .game-over-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .night-mode .game-over-screen {
            background: rgba(30, 30, 50, 0.95);
            color: #fff;
        }

        .game-over-screen.show {
            display: block;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .game-over-screen h2 {
            color: #e74c3c;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 1.5em;
            margin: 20px 0;
            color: #667eea;
        }

        .night-mode .final-score {
            color: #a8b2ff;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            #gameCanvas {
                height: 300px;
            }

            .btn {
                padding: 12px 30px;
                font-size: 1em;
            }
        }
    </style>
    </head>
    <body>
        <div class="game-container">
            <h1>ü¶ñ Â∞èÊÅêÈæôÂø´Ë∑ë</h1>
            <div class="score-board">
                <div class="score">ÂàÜÊï∞: <span id="score">0</span></div>
                <div class="score">ÊúÄÈ´òÂàÜ: <span id="highScore">0</span></div>
            </div>

            <div class="skin-selector" id="skinSelector">
                <label>ÈÄâÊã©ÁöÆËÇ§:</label>
                <div class="skin-options">
                    <div class="skin-option selected" data-skin="classic"
                        style="background: linear-gradient(135deg, #667eea, #764ba2);"
                        title="ÁªèÂÖ∏Á¥´Ëâ≤"></div>
                    <div class="skin-option" data-skin="red"
                        style="background: linear-gradient(135deg, #ff6b6b, #ff8e53);"
                        title="ÁÅ´ÁÑ∞Á∫¢"></div>
                    <div class="skin-option" data-skin="green"
                        style="background: linear-gradient(135deg, #56ab2f, #a8e063);"
                        title="Ê£ÆÊûóÁªø"></div>
                    <div class="skin-option" data-skin="blue"
                        style="background: linear-gradient(135deg, #2193b0, #6dd5ed);"
                        title="Êµ∑Ê¥ãËìù"></div>
                    <div class="skin-option locked" data-skin="gold"
                        style="background: linear-gradient(135deg, #f7971e, #ffd200);"
                        title="ÈªÑÈáë (1000ÂàÜËß£ÈîÅ)"></div>
                    <div class="skin-option locked" data-skin="rainbow"
                        style="background: linear-gradient(135deg, #ff0080, #ff8c00, #40e0d0);"
                        title="ÂΩ©Ëôπ (2000ÂàÜËß£ÈîÅ)"></div>
                </div>
            </div>

            <canvas id="gameCanvas"></canvas>

            <div class="pause-screen" id="pauseScreen">
                <div class="pause-content">
                    <h2>‚è∏Ô∏è Ê∏∏ÊàèÊöÇÂÅú</h2>
                    <p style="font-size: 1.2em; margin: 20px 0;">ÂΩìÂâçÂàÜÊï∞: <span
                            id="pauseScore">0</span></p>
                    <button class="btn" id="resumeBtn">ÁªßÁª≠Ê∏∏Êàè</button>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="startBtn">ÂºÄÂßãÊ∏∏Êàè</button>
            </div>
            <div class="instructions" id="instructions">
                üí° ÊåâÁ©∫Ê†ºÈîÆÊàñÁÇπÂáªÂ±èÂπïË∑≥Ë∑É | Êåâ‰∏ãÁÆ≠Â§¥ÈîÆÂä†ÈÄü‰∏ãËêΩ | ESCÊöÇÂÅú
            </div>
        </div>

        <div class="game-over-screen" id="gameOverScreen">
            <h2>Ê∏∏ÊàèÁªìÊùü!</h2>
            <div class="final-score">‰Ω†ÁöÑÂàÜÊï∞: <span id="finalScore">0</span></div>
            <button class="btn" id="restartBtn">ÂÜçÁé©‰∏ÄÊ¨°</button>
        </div>

        <div class="notification" id="notification">
            üöÄ ‰∫åÊÆµË∑≥Â∑≤Ëß£ÈîÅÔºÅ
        </div>

        <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const finalScoreElement = document.getElementById('finalScore');
        const pauseScoreElement = document.getElementById('pauseScore');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const pauseScreen = document.getElementById('pauseScreen');
        const notification = document.getElementById('notification');
        const instructions = document.getElementById('instructions');
        const skinSelector = document.getElementById('skinSelector');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Skin system
        const skins = {
            classic: { body: '#667eea', accent: '#5568d3' },
            red: { body: '#ff6b6b', accent: '#ff8e53' },
            green: { body: '#56ab2f', accent: '#a8e063' },
            blue: { body: '#2193b0', accent: '#6dd5ed' },
            gold: { body: '#f7971e', accent: '#ffd200' },
            rainbow: { body: 'rainbow', accent: 'rainbow' }
        };

        let currentSkin = localStorage.getItem('dinoSkin') || 'classic';
        let unlockedSkins = JSON.parse(localStorage.getItem('unlockedSkins')) || ['classic', 'red', 'green', 'blue'];

        // Update skin selector
        function updateSkinSelector() {
            document.querySelectorAll('.skin-option').forEach(option => {
                const skin = option.dataset.skin;
                option.classList.remove('selected', 'locked');
                
                if (skin === currentSkin) {
                    option.classList.add('selected');
                }
                
                if (!unlockedSkins.includes(skin)) {
                    option.classList.add('locked');
                }
            });
        }

        // Skin selection
        document.querySelectorAll('.skin-option').forEach(option => {
            option.addEventListener('click', () => {
                const skin = option.dataset.skin;
                if (unlockedSkins.includes(skin)) {
                    currentSkin = skin;
                    localStorage.setItem('dinoSkin', currentSkin);
                    updateSkinSelector();
                }
            });
        });

        updateSkinSelector();

        // Game variables
        let gameRunning = false;
        let isPaused = false;
        let score = 0;
        let highScore = localStorage.getItem('dinoHighScore') || 0;
        highScoreElement.textContent = highScore;
        let gameSpeed = 6;
        let gravity = 0.6;
        let nightMode = false;
        let doubleJumpUnlocked = false;
        let currentWeather = 'clear';
        let weatherChangeCounter = 0;

        // Get skin colors
        function getSkinColors() {
            if (currentSkin === 'rainbow') {
                const hue = (Date.now() / 10) % 360;
                return {
                    body: `hsl(${hue}, 70%, 60%)`,
                    accent: `hsl(${(hue + 30) % 360}, 70%, 50%)`
                };
            }
            return skins[currentSkin];
        }

        // Dino object
        const dino = {
            x: 50,
            y: 0,
            width: 50,
            height: 55,
            velocityY: 0,
            jumping: false,
            ducking: false,
            hasDoubleJumped: false,
            
            draw() {
                const baseY = canvas.height - this.y - this.height;
                const colors = getSkinColors();
                const bodyColor = nightMode ? colors.body : colors.body;
                const accentColor = nightMode ? colors.accent : colors.accent;
                
                const scale = 0.75;
                const offsetX = this.x + (this.width * (1 - scale) / 2);
                const offsetY = baseY + (this.height * (1 - scale));
                
                ctx.fillStyle = accentColor;
                ctx.fillRect(offsetX - 6 * scale, offsetY + 15 * scale, 12 * scale, 8 * scale);
                ctx.fillRect(offsetX - 9 * scale, offsetY + 20 * scale, 8 * scale, 6 * scale);
                
                ctx.fillStyle = bodyColor;
                ctx.fillRect(offsetX, offsetY, 35 * scale, 40 * scale);
                ctx.fillRect(offsetX + 25 * scale, offsetY - 5 * scale, 12 * scale, 20 * scale);
                ctx.fillRect(offsetX + 30 * scale, offsetY - 15 * scale, 20 * scale, 18 * scale);
                
                ctx.fillStyle = accentColor;
                ctx.fillRect(offsetX + 45 * scale, offsetY - 10 * scale, 8 * scale, 10 * scale);
                
                ctx.fillStyle = nightMode ? '#fff' : '#000';
                ctx.fillRect(offsetX + 40 * scale, offsetY - 12 * scale, 4 * scale, 4 * scale);
                
                ctx.fillStyle = '#fff';
                ctx.fillRect(offsetX + 41 * scale, offsetY - 11 * scale, 2 * scale, 2 * scale);
                ctx.fillRect(offsetX + 46 * scale, offsetY - 8 * scale, 2 * scale, 3 * scale);
                ctx.fillRect(offsetX + 49 * scale, offsetY - 8 * scale, 2 * scale, 3 * scale);
                
                ctx.fillStyle = accentColor;
                for (let i = 0; i < 3; i++) {
                    ctx.fillRect(offsetX + (8 + i * 10) * scale, offsetY - 2 * scale, 6 * scale, 4 * scale);
                }
                
                ctx.fillStyle = bodyColor;
                ctx.fillRect(offsetX + 8 * scale, offsetY + 15 * scale, 6 * scale, 12 * scale);
                ctx.fillRect(offsetX + 20 * scale, offsetY + 15 * scale, 6 * scale, 12 * scale);
                
                const legOffset = Math.floor(score / 5) % 2 === 0 ? 0 : 4 * scale;
                ctx.fillRect(offsetX + 5 * scale, offsetY + 40 * scale, 8 * scale, 15 * scale + legOffset);
                ctx.fillRect(offsetX + 22 * scale, offsetY + 40 * scale, 8 * scale, 15 * scale - legOffset);
                
                ctx.fillRect(offsetX + 3 * scale, offsetY + 53 * scale + legOffset, 12 * scale, 4 * scale);
                ctx.fillRect(offsetX + 20 * scale, offsetY + 53 * scale - legOffset, 12 * scale, 4 * scale);
                
                if (doubleJumpUnlocked && this.jumping && !this.hasDoubleJumped) {
                    ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
                    ctx.beginPath();
                    ctx.arc(offsetX + 25 * scale, offsetY - 20 * scale, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#FFD700';
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText('‚ú®', offsetX + 20 * scale, offsetY - 15 * scale);
                }
            },
            
            jump() {
                if (!this.jumping) {
                    this.velocityY = 15;
                    this.jumping = true;
                    this.hasDoubleJumped = false;
                } else if (doubleJumpUnlocked && !this.hasDoubleJumped && this.y > 10) {
                    this.velocityY = 14;
                    this.hasDoubleJumped = true;
                    createTrailParticles();
                }
            },
            
            update() {
                this.velocityY -= gravity;
                this.y += this.velocityY;
                
                if (this.y <= 0) {
                    if (this.jumping) {
                        createDustParticles();
                    }
                    this.y = 0;
                    this.velocityY = 0;
                    this.jumping = false;
                    this.hasDoubleJumped = false;
                }
                
                // Running dust
                if (!this.jumping && Math.random() < 0.1) {
                    createRunningDust();
                }
            }
        };

        // Obstacle class
        class Obstacle {
            constructor(type) {
                this.type = type;
                this.x = canvas.width;
                this.width = type === 'cactus' ? 20 : 35;
                this.height = type === 'cactus' ? 40 : 30;
                this.y = type === 'cactus' ? 0 : 50 + Math.random() * 50;
            }
            
            draw() {
                ctx.fillStyle = nightMode ? '#ff6b6b' : '#e74c3c';
                
                if (this.type === 'cactus') {
                    ctx.fillRect(this.x, canvas.height - this.height, this.width, this.height);
                    ctx.fillRect(this.x - 5, canvas.height - this.height + 10, 8, 15);
                    ctx.fillRect(this.x + this.width - 3, canvas.height - this.height + 10, 8, 15);
                } else {
                    ctx.fillRect(this.x, canvas.height - this.y - this.height, this.width, this.height);
                    const wingOffset = Math.floor(score / 3) % 2 === 0 ? -5 : 5;
                    ctx.fillRect(this.x - 5, canvas.height - this.y - this.height + 10, 15, 5 + wingOffset);
                    ctx.fillRect(this.x + 25, canvas.height - this.y - this.height + 10, 15, 5 - wingOffset);
                }
            }
            
            update() {
                this.x -= gameSpeed;
            }
            
            isOffScreen() {
                return this.x + this.width < 0;
            }
            
            collidesWith(dino) {
                return (
                    dino.x < this.x + this.width - 5 &&
                    dino.x + dino.width - 5 > this.x &&
                    canvas.height - dino.y - dino.height < canvas.height - (this.type === 'cactus' ? 0 : this.y) &&
                    canvas.height - dino.y > canvas.height - (this.type === 'cactus' ? this.height : this.y + this.height)
                );
            }
        }

        // Cloud class
        class Cloud {
            constructor() {
                this.x = canvas.width + Math.random() * 200;
                this.y = Math.random() * (canvas.height / 2);
                this.width = 60 + Math.random() * 40;
                this.height = 30;
                this.speed = 1 + Math.random();
            }
            
            draw() {
                ctx.fillStyle = nightMode ? 'rgba(200, 200, 255, 0.1)' : 'rgba(200, 200, 200, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.height / 2, 0, Math.PI * 2);
                ctx.arc(this.x + this.width / 3, this.y - 10, this.height / 2, 0, Math.PI * 2);
                ctx.arc(this.x + this.width / 1.5, this.y, this.height / 2, 0, Math.PI * 2);
                ctx.fill();
            }
            
            update() {
                this.x -= this.speed;
                if (this.x + this.width < 0) {
                    this.x = canvas.width + Math.random() * 200;
                    this.y = Math.random() * (canvas.height / 2);
                }
            }
        }

        // Background Mountain
        class Mountain {
            constructor() {
                this.x = canvas.width;
                this.height = 80 + Math.random() * 60;
                this.width = 100 + Math.random() * 100;
                this.speed = 0.5;
            }
            
            draw() {
                ctx.fillStyle = nightMode ? 'rgba(100, 100, 150, 0.2)' : 'rgba(150, 150, 150, 0.2)';
                ctx.beginPath();
                ctx.moveTo(this.x, canvas.height);
                ctx.lineTo(this.x + this.width / 2, canvas.height - this.height);
                ctx.lineTo(this.x + this.width, canvas.height);
                ctx.closePath();
                ctx.fill();
            }
            
            update() {
                this.x -= this.speed;
                if (this.x + this.width < 0) {
                    this.x = canvas.width;
                    this.height = 80 + Math.random() * 60;
                    this.width = 100 + Math.random() * 100;
                }
            }
        }

        // Speed Line
        class SpeedLine {
            constructor() {
                this.x = canvas.width;
                this.y = Math.random() * canvas.height;
                this.length = 20 + Math.random() * 40;
                this.speed = gameSpeed * 2;
                this.opacity = 0.3 + Math.random() * 0.3;
            }
            
            draw() {
                ctx.strokeStyle = nightMode ? `rgba(200, 200, 255, ${this.opacity})` : `rgba(100, 100, 100, ${this.opacity})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x - this.length, this.y);
                ctx.stroke();
            }
            
            update() {
                this.x -= this.speed;
            }
            
            isDead() {
                return this.x < -this.length;
            }
        }

        // Weather Particle
        class WeatherParticle {
            constructor(type) {
                this.type = type;
                this.x = Math.random() * canvas.width;
                this.y = -10;
                this.size = type === 'rain' ? 2 : (type === 'snow' ? 3 : 4);
                this.speedY = type === 'rain' ? 8 + Math.random() * 4 : (type === 'snow' ? 1 + Math.random() * 2 : 0);
                this.speedX = type === 'sand' ? 3 + Math.random() * 2 : (type === 'snow' ? Math.random() - 0.5 : 0);
            }
            
            draw() {
                if (this.type === 'rain') {
                    ctx.strokeStyle = 'rgba(100, 150, 255, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x, this.y + 10);
                    ctx.stroke();
                } else if (this.type === 'snow') {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 'sand') {
                    ctx.fillStyle = 'rgba(194, 178, 128, 0.4)';
                    ctx.fillRect(this.x, this.y, this.size, this.size);
                }
            }
            
            update() {
                this.y += this.speedY;
                this.x += this.speedX;
            }
            
            isDead() {
                return this.y > canvas.height || this.x < 0 || this.x > canvas.width;
            }
        }

        // Dust Particle
        class DustParticle {
            constructor(x, y, type = 'landing') {
                this.x = x;
                this.y = y;
                this.vx = type === 'landing' ? (Math.random() - 0.5) * 3 : -Math.random() * 2;
                this.vy = type === 'landing' ? -Math.random() * 3 : -Math.random() * 1;
                this.life = 20 + Math.random() * 10;
                this.maxLife = this.life;
                this.size = 2 + Math.random() * 2;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.life--;
            }
            
            draw() {
                const alpha = this.life / this.maxLife;
                ctx.fillStyle = `rgba(150, 150, 150, ${alpha * 0.5})`;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }
            
            isDead() {
                return this.life <= 0;
            }
        }

        // Trail Particle
        class TrailParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.life = 30;
                this.maxLife = 30;
                this.hue = Math.random() * 360;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
            }
            
            draw() {
                const alpha = this.life / this.maxLife;
                ctx.fillStyle = `hsla(${this.hue}, 100%, 60%, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            isDead() {
                return this.life <= 0;
            }
        }

        let obstacles = [];
        let clouds = [];
        let mountains = [];
        let speedLines = [];
        let weatherParticles = [];
        let dustParticles = [];
        let trailParticles = [];
        let frameCount = 0;
        let obstacleFrequency = 90;

        // Initialize
        for (let i = 0; i < 5; i++) {
            clouds.push(new Cloud());
        }
        for (let i = 0; i < 3; i++) {
            mountains.push(new Mountain());
        }

        // Particle creators
        function createDustParticles() {
            for (let i = 0; i < 8; i++) {
                dustParticles.push(new DustParticle(
                    dino.x + dino.width / 2,
                    canvas.height - 5,
                    'landing'
                ));
            }
        }

        function createRunningDust() {
            dustParticles.push(new DustParticle(
                dino.x + Math.random() * dino.width,
                canvas.height - 5,
                'running'
            ));
        }

        function createTrailParticles() {
            for (let i = 0; i < 15; i++) {
                trailParticles.push(new TrailParticle(
                    dino.x + dino.width / 2,
                    canvas.height - dino.y - dino.height / 2
                ));
            }
        }

        function showNotification(message, duration = 2000) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function changeWeather() {
            const weathers = ['clear', 'rain', 'snow', 'sand'];
            const oldWeather = currentWeather;
            currentWeather = weathers[Math.floor(Math.random() * weathers.length)];
            
            if (currentWeather !== oldWeather && currentWeather !== 'clear') {
                const weatherNames = { rain: 'üåßÔ∏è Èõ®Â§©', snow: '‚ùÑÔ∏è Èõ™Â§©', sand: 'üå™Ô∏è Ê≤ôÂ∞òÊö¥' };
                showNotification(weatherNames[currentWeather], 2000);
            }
        }

        // Game loop
        function gameLoop() {
            if (!gameRunning || isPaused) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw mountains
            mountains.forEach(mountain => {
                mountain.update();
                mountain.draw();
            });
            
            // Draw ground
            ctx.fillStyle = nightMode ? '#4a4a6a' : '#999';
            ctx.fillRect(0, canvas.height - 5, canvas.width, 5);
            
            // Update and draw clouds
            clouds.forEach(cloud => {
                cloud.update();
                cloud.draw();
            });
            
            // Speed lines (when speed > 10)
            if (gameSpeed > 10 && Math.random() < 0.3) {
                speedLines.push(new SpeedLine());
            }
            speedLines = speedLines.filter(line => {
                line.update();
                line.draw();
                return !line.isDead();
            });
            
            // Weather system
            if (currentWeather !== 'clear' && Math.random() < 0.3) {
                weatherParticles.push(new WeatherParticle(currentWeather));
            }
            weatherParticles = weatherParticles.filter(p => {
                p.update();
                p.draw();
                return !p.isDead();
            });
            
            // Update and draw particles
            dustParticles = dustParticles.filter(p => {
                p.update();
                p.draw();
                return !p.isDead();
            });
            
            trailParticles = trailParticles.filter(p => {
                p.update();
                p.draw();
                return !p.isDead();
            });
            
            // Update and draw dino
            dino.update();
            dino.draw();
            
            // Spawn obstacles
            frameCount++;
            if (frameCount % obstacleFrequency === 0) {
                const birdChance = nightMode ? 0.5 : 0.7;
                const type = Math.random() > birdChance ? 'bird' : 'cactus';
                obstacles.push(new Obstacle(type));
            }
            
            // Update and draw obstacles
            obstacles.forEach((obstacle, index) => {
                obstacle.update();
                obstacle.draw();
                
                if (obstacle.isOffScreen()) {
                    obstacles.splice(index, 1);
                    score += 10;
                    scoreElement.textContent = score;
                    
                    // Unlock skins
                    if (score >= 1000 && !unlockedSkins.includes('gold')) {
                        unlockedSkins.push('gold');
                        localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
                        updateSkinSelector();
                        showNotification('üèÜ ÈªÑÈáëÁöÆËÇ§Â∑≤Ëß£ÈîÅÔºÅ', 3000);
                    }
                    if (score >= 2000 && !unlockedSkins.includes('rainbow')) {
                        unlockedSkins.push('rainbow');
                        localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
                        updateSkinSelector();
                        showNotification('üåà ÂΩ©ËôπÁöÆËÇ§Â∑≤Ëß£ÈîÅÔºÅ', 3000);
                    }
                    
                    if (score % 100 === 0) {
                        gameSpeed += nightMode ? 0.4 : 0.3;
                        obstacleFrequency = Math.max(nightMode ? 50 : 65, obstacleFrequency - 3);
                    }
                    
                    if (score % 250 === 0 && score > 0) {
                        nightMode = !nightMode;
                        document.body.classList.toggle('night-mode');
                        
                        if (nightMode && !doubleJumpUnlocked) {
                            doubleJumpUnlocked = true;
                            showNotification('üöÄ ‰∫åÊÆµË∑≥Â∑≤Ëß£ÈîÅÔºÅ', 3000);
                            instructions.textContent = 'üí° ÊåâÁ©∫Ê†ºÈîÆË∑≥Ë∑É | Á©∫‰∏≠ÂÜçÊåâ‰∏ÄÊ¨°‰ΩøÁî®‰∫åÊÆµË∑≥ | Êåâ‰∏ãÁÆ≠Â§¥ÈîÆÂä†ÈÄü‰∏ãËêΩ | ESCÊöÇÂÅú';
                            gameSpeed += 0.5;
                            obstacleFrequency = Math.max(55, obstacleFrequency - 5);
                        }
                        
                        // Change weather
                        changeWeather();
                    }
                }
                
                if (obstacle.collidesWith(dino)) {
                    gameOver();
                }
            });
            
            requestAnimationFrame(gameLoop);
        }

        // Start game
        function startGame() {
            gameRunning = true;
            isPaused = false;
            score = 0;
            gameSpeed = 6;
            obstacleFrequency = 90;
            obstacles = [];
            dustParticles = [];
            trailParticles = [];
            speedLines = [];
            weatherParticles = [];
            frameCount = 0;
            nightMode = false;
            doubleJumpUnlocked = false;
            currentWeather = 'clear';
            document.body.classList.remove('night-mode');
            dino.y = 0;
            dino.velocityY = 0;
            dino.jumping = false;
            dino.hasDoubleJumped = false;
            scoreElement.textContent = score;
            startBtn.textContent = 'Ê∏∏ÊàèËøõË°å‰∏≠...';
            startBtn.disabled = true;
            gameOverScreen.classList.remove('show');
            pauseScreen.classList.remove('show');
            skinSelector.style.display = 'none';
            instructions.textContent = 'üí° ÊåâÁ©∫Ê†ºÈîÆÊàñÁÇπÂáªÂ±èÂπïË∑≥Ë∑É | Êåâ‰∏ãÁÆ≠Â§¥ÈîÆÂä†ÈÄü‰∏ãËêΩ | ESCÊöÇÂÅú';
            gameLoop();
        }

        // Pause game
        function pauseGame() {
            if (!gameRunning || isPaused) return;
            isPaused = true;
            pauseScoreElement.textContent = score;
            pauseScreen.classList.add('show');
        }

        // Resume game
        function resumeGame() {
            if (!isPaused) return;
            isPaused = false;
            pauseScreen.classList.remove('show');
            gameLoop();
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            startBtn.textContent = 'ÂºÄÂßãÊ∏∏Êàè';
            startBtn.disabled = false;
            finalScoreElement.textContent = score;
            skinSelector.style.display = 'block';
            
            if (score > highScore) {
                highScore = score;
                highScoreElement.textContent = highScore;
                localStorage.setItem('dinoHighScore', highScore);
            }
            
            setTimeout(() => {
                gameOverScreen.classList.add('show');
            }, 100);
        }

        // Event listeners
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
            gameOverScreen.classList.remove('show');
            startGame();
        });
        resumeBtn.addEventListener('click', resumeGame);

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Escape') {
                e.preventDefault();
                if (gameRunning && !isPaused) {
                    pauseGame();
                } else if (isPaused) {
                    resumeGame();
                }
                return;
            }
            
            if (!gameRunning) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    startGame();
                }
                return;
            }
            
            if (isPaused) return;
            
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                dino.jump();
            }
            
            if (e.code === 'ArrowDown') {
                e.preventDefault();
                if (dino.jumping) {
                    dino.velocityY -= 2;
                }
            }
        });

        // Touch/Click controls
        canvas.addEventListener('click', () => {
            if (!gameRunning) {
                startGame();
            } else if (!isPaused) {
                dino.jump();
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameRunning) {
                startGame();
            } else if (!isPaused) {
                dino.jump();
            }
        });
    </script>
    </body>
</html>
